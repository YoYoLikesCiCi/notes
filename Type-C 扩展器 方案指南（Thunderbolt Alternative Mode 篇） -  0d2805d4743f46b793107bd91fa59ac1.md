# Type-C 扩展器 方案指南（Thunderbolt Alternative Mode 篇） - 知乎

[https://zhuanlan.zhihu.com/p/390425571](https://zhuanlan.zhihu.com/p/390425571)

![Type-C%20%E6%89%A9%E5%B1%95%E5%99%A8%20%E6%96%B9%E6%A1%88%E6%8C%87%E5%8D%97%EF%BC%88Thunderbolt%20Alternative%20Mode%20%E7%AF%87%EF%BC%89%20-%20%200d2805d4743f46b793107bd91fa59ac1/v2-05ffda4a09e846111fa12c67d00f3e9a_1440w.jpg](Type-C%20%E6%89%A9%E5%B1%95%E5%99%A8%20%E6%96%B9%E6%A1%88%E6%8C%87%E5%8D%97%EF%BC%88Thunderbolt%20Alternative%20Mode%20%E7%AF%87%EF%BC%89%20-%20%200d2805d4743f46b793107bd91fa59ac1/v2-05ffda4a09e846111fa12c67d00f3e9a_1440w.jpg)

## Introduction

由于 Thunderbolt 技术以及相关的产品一直在 intel 自己的管制之下，加上NDA 的泄密控制，因此本文的很多信息没法找到很直接的技术文档来佐证，所以本文是参考而非指南，请注意了。如果作者后期能拿到 intel 的相关文档 也顶多删掉谬误内容而非更新

由于我们关注的应用主要集中在 基于 Type-C 的应用，因此文章核心是关于Thunderbolt3和4 的 主机/设备而非更早的 基于 mini DP 接口的 Thunderbolt 1代 和 2代； 对于 USB Type-C 的生态，USB-IF 推出了进一步的 USB4 规范[[1]](https://zhuanlan.zhihu.com/p/390425571#ref_1)，这个东西不是本文的重点，我也许会提到但不会去展开

早期雷电的简要介绍可以参考这篇：

此外的话，在 DP1.4（HBR3） Alternative Mode 普及以后，确实雷电 类的应用被挤压到相对边缘的位置了，但其实 雷电应用的必要性或者价值高低也不是本文的重点，这类讨论恕不奉陪

建议有一定计算机硬件 以及 数字电路 知识的基础再尝试阅读，本文没有考虑照顾小白的理论基础

全文大约 23K 字，由于信息量庞大以及考据量过多，近期应该还会有两三次较大规模的更新提高完成度，按照传播学理论来讲，字数越多 内容越深奥 ，愿意看的人越少，我有点好奇会有多少人真的能把这篇给看完。

我写到一半的时候发觉其实把文章拆成至少三篇 更合理一点，但一方面我对太监/挤牙膏深恶痛绝，另一方面也不想在每个分篇里复读 基础知识，所以想想还是合在一起了

结构上会和上篇一样，由主机口的结构起始渐入 设备的领域，毕竟主机口的性能才是决定最终一切性能的所在

不过各部分关联性并不是很强，不要被过于庞大的规模吓到，建议按照目录 找自己感兴趣的部分

## List of Noun Explanation

DP MST：全称 DisplayPort Multi-Stream Transport （DP 多流传输）也有称作DP 菊花链，一种单 DP输出 多个不同画面（不同显示器）的技术，多个画面输出共享带宽

eGPU： 全称 External GPU，即外置GPU/外置显卡

PD：全称 Power Delivery，虽然通常跟 Quick Charge以及 华为的 SCP，步步高系的 VOOC等技术合称为快充技术，但是Power Delivery 其实是目前 Type-C 生态的核心支柱， DP Alternative Mode 以及 Thunderbolt Mode 等 USB-C 进阶模式都依赖 Power delivery 通信来进行前期配置

待定，会根据反馈增加

## Q&A Fast Review

不同于 之前的 DP Alternative Mode，Thunderbolt 是有自己的官方网站或者说技术社区 [Thunderbolt™ Community](https://link.zhihu.com/?target=https%3A//thunderbolttechnology.net/) [[2]](https://zhuanlan.zhihu.com/p/390425571#ref_2)，然而遗憾的是 Thunderbolt™ Community 贴出来的技术资料在不少地方掩盖了参数细节，导致其提供的技术指标 会与实际产品的性能相悖

本文接下来提到的不少内容会在细节上与 Thunderbolt™ Community 所提供的资料相悖，请自行排定可信度

**Q：什么是 雷电/雷雳 （Thunderbolt）？有什么作用**

A：抛开过于老旧的初代与二代 Thunderbolt ，目前我们说的雷电接口/协议 一般就是指 Thunderbolt 3 或者 Thunderbolt 4

按照 官方社区 Thunderbolt Technology Community [[3]](https://zhuanlan.zhihu.com/p/390425571#ref_3) 的手册，Thunderbolt 3/4 是一个单线支持 双向 40Gbps 传输速度，高达100W 电力传输能力的 次世代通用传输方案，可以支持 比如 多个4K 显示器，外置GPU，10GbE 网卡等很 exciting 的应用

但实际上官方社区描述的这些 是建立在 狭义的 Thunderbolt Alt Mode （也是本文的重点）与高规格 Power Delivery 的基础上，实际上市面上的 Thunderbolt 3/4 接口支持多种模式，在官方社区的手册[[4]](https://zhuanlan.zhihu.com/p/390425571#ref_4)中就有介绍：

- USB Only Mode

支持 仅以USB 3.2 Gen2 模式运行，高达10Gbps 的USB传输

- DisplayPort Only Mode & DisplayPort and USB Mixed Mode（4 Lane 与 2Lane DP Alternative Mode）

能同时支持 DP输出，USB传输以及PD 充电功能

- Thunderbolt Mode（本文重点，40Gbps 传输模式）

支持所有媒体宣传过的 超 Coooooooool 应用

- Thunderbolt Networking Mode（雷电网桥模式）

将两台主机的雷电口直接连起来就可以激活该模式，可以将雷电接口虚拟为网卡，获得万兆甚至更高的传输网络。

这个不是本文重点，具体的可以参照 雷电网桥的白皮书[[5]](https://zhuanlan.zhihu.com/p/390425571#ref_5)

绝大部分的用户都是在 DP Alt Mode，常规的 USB3.2 Gen2 协议两种种应用模式下使用，而非真正的 Thunderbolt 协议（Thunerbolt Mode）

**Q：我的雷电/雷雳 口能像宣传的那样运行在 40Gbps吗**

A：Yes and No. 如同上面提到的，大部分用户的雷电3 接口其实只是作为 DP Alt Mode/USB 3.2 gen2 口来使用，即便用户专门购买了 使用 雷电控制器 能够触发 Thunderbolt Alt Mode 的产品，也可能遇到以下三方面的问题

- 主机方面

早期的 雷电3 主机口阉割现象严重，采用半速雷电主控/阉割上游PCIe通道/阉割DP 输入通道 导致无法支持40Gbps速率的传输甚至无法 取得40Gbps 的握手速率

- 线缆方面

没有Thunderbolt e-mark 的 Type-C线缆或者仅搭载了 20Gbps Thunderbolt e-mark 的 Type-C 线缆导致握手速率停留在 20Gbps水平

或者某些做工稀烂的线缆即使能握手40Gbps，实际速度衰减极为严重

更惨的无法支持 Thunderbolt 协议握手的线缆就不提了

- 设备方面

很多单一用途的 雷电设备，即使用的是全速方案，主机线缆也支持，能握手40Gbps 速率，但是其本身的设计并不能吃满40Gbps

比如 雷电硬盘盒，只能吃到22Gbps带宽，万兆雷电网卡那也就是 10Gbps，至于雷电 4K显示器，很多撑死了也就吃 20Gbps的 视频带宽

**Q：那么雷电接口（而不是雷电协议）的优势在哪里？缺点呢？**

A：优势很简单，支持的模式很多，除了 实际本体的 Thunderbolt Alt Mode 以外，覆盖了 DP1.4 Alt Mode，这就已经可以覆盖绝大多数的日常应用了

其他的优势主要是由 Thunderbolt Alt Mode设备带来的，雷电 设备能够为 下游提供 4Lane PCIe 3.0 的物理接口，为各类高性能外设的 建立提供了平台；此外能为 下游再提供一个 Thunderbolt 接口从而把更多的Type-C 设备串联起来

缺点也很明显：由于支持了大量的功能，对于Thunderbolt 的更新需求量是很大的，比如目前 USB 已经推出支持 20Gbps 传输的 USB3.2 Gen2x2 模式差不多两年了，雷电 4仍未支持； 消费级平台的PCIe 已经支持到 Gen5 ，但雷电 主控的 PCIe 支持还停留在Gen 3；

成本奇高，以及授权壁垒，目前能支持 Thunderbolt alt mode的主机或是设备都是由Intel 提供的支持，即使苹果 目前可以在自己的M 系列处理器中集成 Thunderbolt 控制器，但是由于 驱动 和 系统等 多个层面的原因，使用体验是远不如 Intel 硬件生态的，AMD 也是

复杂的外部输入和控制需求导致早期 主机雷电的阉割现象极为严重，在 Intel 于 Tiger Lake 处理器集成雷电 4控制器 来统一规范之后，确实 极大降低了使用雷电的入门成本，也一定程度肃清了雷电 主机的阉割乱象

但是在同时期 苹果脱离了 X86 阵营，采用的自己开发的 Apple Silicon M1 系列 同样集成了雷电控制器

Mac OS 对 DP MST 支持的缺乏，以及脱离X86 环境以后对原PCIe 设备的驱动支持 一夕全无，雷电设备的诸多特色应用比如 eGPU等设备无法在M1主机上使用，又造成了新的乱象

**Q：涉及雷电设备的主要类型？**

A：本篇基本涵盖了所有的雷电设备类型，不过像 Universal Audio Arrow 那样资料很少的雷电3 声卡 产品可能不会给予很多关注

一般情况下 雷电3/雷电 4会被应用在以下几类使用产品

0.外挂式的主机雷电口（本文不涉及Tiger Lake 或是 M1 等集成式雷电控制器方案）

1.较高自由度的扩展坞站/扩展器

2. 倾向于数据类传输（一般都是挂在PCIe总线上）的设备

典型的就是 eGPU 设备/雷电移动硬盘，其他的还有 雷电磁盘阵列，雷电 转10GbE 网卡以及相关的变种，雷电转 SFP+ 光纤通信模块

3.倾向于 视频信号传输，一般是显示器，也有转接器形式的产品

## Advanced Tech Specs

在先前 DP Alternative Mode 的内容中，其实并没有对 Power Delivery 相关的内容，以及包括线缆系统进行较为深入的解析，很遗憾的是由于 雷电 规范各种边边角角的特性，不得不对这两方面的内容深入一点了

跟 DP Alt Mode "USB的归USB，DP归DP" 两者在物理线路中并行传输的策略不同，Thunderbolt 是实实在在地建立了一个新的高速传输协议以及相关规范；在主机和设备 建立Thunderbolt Alt Mode 的前提下，二者之间就只有一条 能够进行 20Gbps/40Gbps 传输的链路，而在主机端吃下的PCIe 和 DP 数据会被主机上的雷电控制器打包成 这个 40Gbps 传输专用的数据包发给设备，再由设备上的雷电控制器解包

也就是说，雷电协议（Thunderbolt Mode）是仅存于雷电控制器之间的高速传输方式，用具体点的图来描述就是这样：

因此不管怎么去使用/研究雷电 方案，雷电控制器是绕不开的；控制器方面，除去 Ice Lake/Tiger Lake系列 以及 M1 系列 直接集成进处理器的 型号。其余的都是 由 Intel 生产的外挂控制器器方案，从雷电 3 到现在雷电4，数量上其实也没多少，如下表所示：

命名规则跟 Core I系列处理器没多大区别，首位表示第几代，第二位 数字越大表示规格越大，第三第四位都一样是40，不用管

## 主机雷电口结构/生态

在雷电3 早期的时候确实有一些用户 会被强劲的性能以及 Type-C 通用化接口所吸引，寻求并且在自己的计算机上添加雷电接口

然而大多用户的探索都不是很顺利，雷电的扩展安装不同于 常规的 比如网卡，声卡，RAID卡之类的插上PCIe卡 ，开机进系统安装驱动就能搞定，主机的雷电扩展结构与控制需求比常规的PCIe 扩展卡要更为复杂

### **雷电主机系统拓补**

这里的话，由于可信的资料有限，只能以 从Compal（仁宝） 流出的一份笔记本设计原理图为例

这款主板设计目前基本可以确认是 Acer 的 Predator Triton 900 PT917-71[[6]](https://zhuanlan.zhihu.com/p/390425571#ref_6) 所 采用，处理器是标压的 第八代 CoffeeLake 移动端处理器，GPU（图中标为 <N18E-G3 witih GDDR6 *8> 的模块） 在实际产品中则是 RTX2080

由于9代及以前的 标压 移动平台拓补结构 跟 桌面平台的基本没差多少，所以也可以直接当作桌面平台来看

而我们的主角，外挂式的雷电控制器的型号虽然不明，但综合推出的时间和后续的技术细节来看，应该是 JHL6540

可以看到在雷电控制器的上游仅有两个输入，一个是来自GPU的一条满血 （4Lane） DP，另一个是来自PCH 的 4Lane PCIe，当然在CoffeeLake 这一代处理器的 PCH 下游PCIe 也就支持到 PCIe Gen3

雷电处理器的下游么，就直连外部的 Type-C接口了，Type-C 配有 PD控制器 TPS65982 ，看起来PD控制器是独立于 雷电控制器吗？不急，往下看细节

*这里还有一个 支持 DP Alt Mode Type C的拓补设计，可以联系上一篇 DP Alt Mode 介绍来看，这里就不多啰嗦了*

### **主机雷电口结构拓补**

Well，按照总拓补的提示翻到43，44页，就很有趣了

43页是雷电控制器的信号原理图拓补

44页是 电源连接，所以就直接看43页内容

可以看到在这一页对雷电 控制器的信号模型做了很直观的区分

1. PCIe 4Lane 接口，与PCH连接
2. DP 输入口 *2，阉割了一个
3. DP 输出口一个，没做出来
4. 外置晶振
5. 外置 SPI Flash 接口
6. 雷电3 主机口 *2，也阉割了一个没做出来

GPIO 部分可以看到被分了两类，一类是 LC GPIO，看标注是含有 I2C通讯定义，HDMI的 配置信道，以及PCIe 唤醒（要求连接到 CPU Wake#） 雷电 CIO 插头事件信号（要求连接到 CPU GPP_D0, )

另一类则是 POC GPIO，附带的表格中做了解释，看起来都是休眠和供电相关的控制引脚

目前到这里为止的资料其实已经透露了不少信息了

抛开板载的那些晶振，Flash ，GPIO 之类的乱七八糟的东西，我们能利用的雷电主控对外接口有：

- 雷电接口*2
- DP 输入*2
- DP输出*1
- 4Lane PCIe Gen3

记好了，后面要频繁考的

我猜有同学会要跟我说这跟 Thunderbolt Community 的 6000系列 Thunderbolt Controller Brief[[7]](https://zhuanlan.zhihu.com/p/390425571#ref_7) 有出入

官方 Brief 这部分指示的是该主控在设备模式下的拓补，Brief 内标注过 8Lane DP 1.2（HBR2），但从不会给 主机口模式下的拓补示意图

不过呢，在雷电主控的 雷电口部分有些问题需要注意，可以看到雷电主控给下游提供了 两发两收 4个差分对 8根线

还提供了USB2.0 的定义，以及 两个AUX 定义，AUX是 Type C的 SBU定义 在Alternative Mode下的 替代功能，这12根线数数是不是还差了什么？

跟正牌的 Type-C 接口对比一下，去掉两对 TX，两对RX，去掉USB 2.0 以及两个 SBU，还剩两个 CC 线不知道在哪里

啊，对了，我们一开始看的那个 拓补图，Type-C 接口还连着一个芯片的对吧，翻到45页看吧

确实有很具体的细节，总共有3部分

1. Type-C 接口
2. TPS65982 主控
3. 主控到接口之间的 TVS防护

我们的重点在主控部分

先看右边部分，是主控连接 Type C接口的一侧，可以看到PD 主控接管的定义真不少，两组 USB2.0，两根CC线，还有两根 SBU，是不是有一些跟雷电主控重合了？

看左边，USB2.0 和AUX 是直接从雷电主控接入的，根据 TPS65982 的功能框图可以看出，这两个数据链路由芯片内的Multiplexer 负责，只不过是由PD控制器 来负责 中继和切换，而CC线则是专由 PD控制器负责的

这个主控既然接管了CC 线，那就是要负责PD 通讯以及 电源控制的了，可以看到 有俩引脚 HV-GATE 用于连接MOS管来控制电压，不过在实际设计中被废弃了，看来这个机子只吃20V的输入电压了

### **雷电口拓补细节**

你以为就这么结束了？ Naive

很多设计细节还是非常有趣的

注意点1：雷电主控 和 PD主控 共享一颗 Flash，也就是说这两个主控的 固件（Firmware）储存在同一颗芯片里

注意点2：除了固件以外，这俩主控共享Flash 以外，还有两处地方是相连的，一处是I2C 通信口用于芯片间通讯，另一处则是 雷电主控 的雷电口POC 部分与PD控制器相连的 HPD部分，推测是用于DP 输出 方面的 DP握手功能

剩下的一页只有关于 雷电控制器的 电源部分原理图，没有多少有价值的内容，虽然给了一个简要的雷电主控内功能模块框图，但是只标注了电源部分

有点有趣的是，雷电控制器上游仅有PCIe 和DP 输入但可以支持仅USB 模式，果然是内置了USB XHCI 控制器

### **雷电口 拓补案例**

由于资料的匮乏，只能拿一个老旧平台老旧主控 的阉割案例来做解析 还是很遗憾

不过至少得到了我们想要的基础结构拓补，拿着这个玩意我们就可以逆向化很多现成的产品了，我们先看雷电主控中使用最广泛 也是每代最高端的 x540 控制器

首先我们知道案例中的 Acer Predator Triton 900 是将雷电主控 JHL6540 阉割了 一个雷电口，一个DP 输入口，一个DP输出口，那么满血的 雷电主控 应该是什么姿态的呢？

- Alpine Ridge 满血雷电主机口拓补

理论上来讲，只看我们能利用的接口的话， Alpine Ridge 雷电控制器拓补 完全体 应该是这样的

顺带提一下，JHL6540理论上和 DSL6540是一样的硬件结构，传闻说是Intel 为了搞定欧盟的器件无铅化要求才进行了一次更新，雷电主控的型号前缀由此从DSL转变为JHL（雷电2 的主控型号都是DSL前缀），不过需要注意的是 DSL6540 与JHL6540 固件并不通用

那么有这个完全体产品的案例吗？

有的，技嘉的 GC Alpine Ridge

从左往右分别是 雷电3 接口2，HDMI输出，mini DP 输入*2

可以看到主要芯片非常直观

1. Alpine Ridge 雷电主控 DSL6540
2. PD 控制器 TPS65982 *2

三者共用一颗 标了蓝点的 固件 Flash

此外，不同于常规 的板卡，雷电扩展卡还有一个5Pin的尾插（暗绿部分）用于GPIO连接

GPIO的 通用定义如下：

是不是觉得很眼熟？

眼熟就对了，先前的 笔记本主板结构里确实有这几个GPIO，除了 SLP_S5#

这个 HDMI 输出并没有通过 芯片进行转换，推测是GPIO中的 HDMI_SDATA与SCLK 是用于 支持显卡DP++模式从而无缝切换HDMI输出？

但是有一点需要注意的是，并非所有板厂的 5 Pin TB_Header 会采用相同的定义，目前有证据显示 技嘉在 300系主板上的 5Pin 定义与常规 5 Pin GPIO 不同，但很遗憾的是没有确切资料明确其定义

- Titan Ridge 雷电主机口拓补迭代

看完了最早的 一代 雷电3 主控，下一代 Titan Ridge 引入了很多新的特性，是第二代也是最后一代雷电3主控

不过很遗憾的是能找到的拓补资料，顶多也就是下面这样的PPT，实在是过于简陋了。

总的来说，从各种资料包括Thunderbolt Community 官方 Brief[[9]](https://zhuanlan.zhihu.com/p/390425571#ref_9) 内都能够确认的新特性是 1.对 DP 输入输出的 支持都更新到了 DP1.4（HBR3），分离了USB2.0 部分，不再由雷电主控内置控制器转换，而是从外部引入

此外在实际应用中也能发现Titan Ridge 主机扩展 对主机的GPIO 要求极大的降低，甚至可以实现 无TB header驱动，在 Alpine Ridge 那个对驱动要求极为严苛的时期是无法想象的，但很遗憾 没有可信资料披露 雷电主控内部的细节

理论上主要结构如下，在这一代的主机雷电公版设计里面，PD控制器也从TPS65982更新到了 TPS65983

要说产品案例的话其实比 Alpine Ridge的扩展卡产品要少得多，比如像 Lenovo，Dell 等计算机供应商一般在笔记本上跟进雷电 更新比较勤快，OEM 板卡依然停留在 6000系 Alpine Ridge 阶段，微星 等DIY 板卡产品大户也是

所以要满血的产品案例仍然是 技嘉GC 系列的 GC Titan Ridge（也正因为技嘉的GC系列雷电卡 接口最全最多，技嘉的BIOS对雷电支持最舒畅一些，技嘉的部件最被青睐一些）

接口排布有了点小变化，自上而下分别为 DP输出，雷电口 *2，mini DP 输入口*2

主控布局也是没变

1. Titan Ridge 雷电3主控 JHL7540
2. PD 控制器 TPS65983 两颗

这三个IC 共享蓝点标记的 Flash

此外暗绿色框标记的依然是 雷电扩展卡 特色的5 pin GPIO 接口，上面暗蓝色 标记的则是 在Titan Ridge 这一代被分离出来的USB2.0 链路，由主板提供接入（但实际上曾有报告称 即使不插这个口，Titan Ridge 扩展卡依然能支持USB2.0 设备，总之结构存疑。）

此外尾部增加了两个6Pin的 ATX12V电源输入，为了支持 100W PD输出，相比Alpine Ridge 多塞了不少电源设计，不过这就不是本篇重点了

不过 Titan Ridge 搭配的 PD控制器也不一定是 TPS65983，也会有 搭配Cypress PD 控制器的变种设计，比如在 NUC 9 石英峡谷[[10]](https://zhuanlan.zhihu.com/p/390425571#ref_10)上，JHL7540 主控搭配的是Cypress 的CYPD5225 主控

另外 由于 CYPD5225 是支持双 Type-C 口的PD控制器，石英峡谷的两个雷电口只需要单颗PD控制器即可，不用堆两颗TPS65983

- Maple Ridge /集成式 雷电主机口拓补迭代

直接进入 Thunderbolt 4 时代，一个新的，但某种意义上又更混乱的阶段。笔记本移动端领域在 Thunderbolt 4 阶段直接抛弃了原有的外挂雷电控制器体系，直接将控制器集成入处理器

笔记本集成式的 雷电主机拓补资料一般只能找到这个PPT，虽然很简陋，但是至少可以看出除了 原来的雷电主控被塞进了 处理器，主要的拓补跟Titan Ridge 差别不大

但是吧...........以 搭载 Tiger Lake以及 Thunderbolt 4 的NUC11 为例

可以在

[@帅到被人追](https://www.zhihu.com/people/75762dc39034d395ad9befe42a91cb23)

的NUC 11 拆解[[11]](https://zhuanlan.zhihu.com/p/390425571#ref_11)中看到 两个雷电 4 （官方标的是1个雷电4 与一个雷电3）对应分别搭载了一颗 JHL8040R Retimer

除了这两个 8040R以外就看不到PD 控制器了，其他唯一相关的可能就这个 TPD6S300 Type-C 接口保护IC了

而在 M1 Mac Mini[[12]](https://zhuanlan.zhihu.com/p/390425571#ref_12) 以及iMac [[13]](https://zhuanlan.zhihu.com/p/390425571#ref_13)中，在两颗JHL8040R 的主板背面可以看到是有两颗 PD控制器 CD3218B12，总之比较令人困惑，不排除 JHL8040R 本身，或者集成在处理器内的雷电控制器 内置了PD 控制器功能 的可能性

外挂式雷电 4 方案并不多，目前主要的案例是 各个板载雷电 4 的Z590主板以及 华硕技嘉两家推出的 雷电 4板卡

GC Maple Ridge 方面:

咋一看似乎跟 Titan Ridge 一模一样，其实仔细一看..........两个 PD 控制器没了

Maple Ridge 板卡上这俩小的是跟 NUC11 上一样的 TPD6S300 Type C口保护方案，并非PD 控制器

总之扑朔迷离............ 华硕的 Thunderbolt EX4 板卡找不到拆机图，但是可以 再参考技嘉的 Z590 Vision D[[14]](https://zhuanlan.zhihu.com/p/390425571#ref_14)

这是外挂 JHL8540的 雷电4 方案，但是同样没有PD 控制器的踪迹

另外一方面相比原先Titan Ridge的最大区别 ，各家都需要更多的 GPIO 来支持新的外挂 Thunderbolt 4 控制器方案了

如下图，左 为 微星 的新雷电 GPIO，右为华硕，都是在原有5 Pin 的基础上再加，但加上来的定义又各不一样

技嘉方面则是再原5 Pin的一旁另加了一个3Pin GPIO，虽然加的最少但是没有披露定义

上文提到过技嘉的 旧 5Pin 与其他厂商的通用 5Pin 有区别，贸然搭配会有 炸卡的风险，可能技嘉暗地里做了改良，故意把5 pin 改成较小的插座，把水搅的更浑了

其实上面两大板厂的新加定义其实很多仍然还是能在先前的 JHL6540 结构中找到

比如 RTD3 定义以及 I2C，WAKE# 不知道具体对应哪个信号，而 像SMB DATA/CLK说不定就是 I2C DATA/CLK 的变名？

所以 雷电 4外挂式的雷电 拓补推测如下，注意是推测的，暂无可靠资料：

可能要我来总结的话，雷电4 这一代应该是准备融合 USB4 的概念，把PD 控制器从 外挂形式集成进现有方案；各板厂则分别按自己的路子做了技术改良，开放更多GPIO交给主板控制，也许这么搞还能顺便提升一下雷电板卡的使用体验；

雷电4 大概说到底还是完全体的 雷电 3罢了，也许也是 40Gbps 以及 PCIe Gen3 环境下的最后一代雷电

### 雷电 拓补 主要变种/阉割案例

上面的内容都很照顾读者，尽量把满血的模型给放出来，下面就是比较辣眼睛的内容了，不过不去碰早期雷电设备，只从雷电4 阶段开始接触的读者可以直接跳过这一部分

主机雷电口的 阉割操作有很大一部分原因跟早期 的技术/市场 环境有关，所以绝大多数案例都集中在 Alpine Ridge 这一代的 主机上

复习一下，主机雷电芯片可用的上游口有：

1. PCIe Gen3 x4
2. DP 输入口 *2，阉割了一个

下游口么：

1. DP 输出口*1
2. 雷电3 口 *2

先前提到的 官方社区的 Thunderbolt 3 Tech Brief[[4]](https://zhuanlan.zhihu.com/p/390425571#ref_4) 中有过 雷电 方案运行对上游接口的基本要求：

> The Basics
> 

直译就是 雷电3 系统的最低 需求是 1路满血 DP1.2输入 & PCIe Gen3 x2

- 常见上游口阉割

在 ThinkPad 以及 eGPU的 Reddit 社区里面其实已经有相关的总结[[15]](https://zhuanlan.zhihu.com/p/390425571#ref_15)，Skylake 时代 机型阉割 PCIe 输入 算是常见操作，不止 Lenovo，Dell和 HP的 笔记本也会有这样的阉割行为

这个帖子也提到过在 Windows 下可以通过 HWinfo 来观测 主机给予 雷电主控的 PCIe 总线数量

同时也可以窥探 主机和 设备雷电控制器型号，近期万能宝有 售卖 假 雷电4 eGPU，就可以用 HW info 观察到真实的设备主控型号

因此雷电3 时代的主机接口性能上下限极大

比如像 先前放出的 Compal 主板设计，由于只有一路DP1.2 （RTX2080虽然可以DP1.4输出，但是 JHL6540只支持 DP1.2输入）输入，所以 雷电 3 单口支持 双4K 显示器的PPT能力是做不到的

PCIe的阉割则会严重影响所有PCIe类外设 比如雷电移动硬盘以及 eGPU的性能

下游口方面的阉割一般 舍弃 DP输出是最为常见的 手法，无论是笔记本还是 桌面板卡都不会将这个输出口做出来，技嘉 GC 系列反而像个异类一样

阉割雷电口虽然说 直接去掉 接口以及相关的PD控制器 是最常见的手法，但还是会有一些比较有趣的变种手段

比如说华硕的 Thunderbolt EX3 该卡主控是 DSL6540，可以明显的看到只有一个雷电 接口以及 一个mini DP 输入口

那么这个 USB接口是怎么来的？先前我们总结的 6540 拓补并没有USB3.1的成分

事实很Surprised，这个USB 口是 雷电口被降格阉割以后所得到的，这样的阉割方式就不需要对应的外围 PD 控制器了

那我有个大胆的想法，我可以阉割掉所有的 DP输入，所有的PD控制器，PCIe 也阉割到 2Lane，把雷电主控当作USB3.1 主控来使用，可否？

这样野蛮的阉割手法也是有案例的比如 Skylake 时代 华硕的旗舰级 ITX 主板M8I[[16]](https://zhuanlan.zhihu.com/p/390425571#ref_16)，那个时候的 PCH没有 10Gbps 的USB3.1，第三方厂商的 USB3.1 主控也是很稀少，所以这个Type-C 的上游其实是一个雷电主控 DSL6540

是不是很 awesome？

事实上 在SkyLake 时代很多 Type-C USB3.1 口都是由阉割后的雷电主控所提供的，不仅仅是桌面板卡，包括Dell的很多笔记本也是如此

不过并不是所有的阉割都 做的这么断子绝孙，比如某些 技嘉Z170 仍然为 雷电主控保留了外围的 PD控制器，后期通过强刷固件可以解锁 雷电功能

除了对 雷电口本身的降格阉割，对于其他接口也会有类似的手段

比如说PCIe

英特尔的 参考设计 都要求 将雷电主控 的上游PCIe 连接至 PCH，PCH 所提供PCIe 缺陷也明显，一个是7代到10代 Core I 结构中， PCH 到CPU 的DMI数据 链路的总带宽也就 相当于 PCIe Gen3 x4，PCH下属设备 如果挂了雷电，用起来容易抢带宽；另一方面离CPU越远，延迟越高，对 eGPU之类的应用不利

目前业内应该只有苹果是明确将 雷电 控制器挂在 处理器的直连 PCIe 下，桌面平台虽然也可以将板卡怼进 直连PCIe 接口，但是也有报告会有 热插拔功能失效等问题

另外一个普遍问题则是DP降格

18年 雷电控制器 更新至 Titan Ridge 支持DP 1.4，不少厂商依然沿用旧型 Alpine Ridge，无法支持DP 1.4输出，这个就不展开了，上文的 Compal 主板设计就是个例子

但其实更要命的是 Intel 自己给出的 参考设计是将雷电控制器的DP 输入跟 核显输出 绑定，而直到 2020年 11代移动端处理器上市以后 才把 处理器核显更新到支持 DP1.4的版本

NUC9 就是一个绝佳的例子

作为一个 显然是要 安装 独立显卡的机型，Intel 自己开发的 NUC硬是要把 雷电 的DP输入 接到 Coffee Lake 的核显上，注意了，NUC9 搭载的雷电主控还是支持 DP1.4 的Titan Ridge 主控 JHL7540

就算是给全了两路 DP1.2 输出又怎么样？难度我会指望 UHD630来 外接 5K显示器吗

不仅是 Intel 自己的 NUC，这类参考设计也影响了绝大部分的笔记本产品，有不少案例证实即使 笔记本搭载了独立显卡，厂商依然依据 参考设计将雷电主控接入核显，导致在使用雷电外接显示器的时候实际是核显在输出

## 线缆&接口 体系

Well，主机体系由于缺乏准确的资料，所以很遗憾难以形成系统化美感的 总结

线缆体系方面，雷电则很大程度上跟 Power Delivery 的规范是重合的，在介绍之前，我们先对 线缆的性能维度进行区分

### 线缆主要性能维度

我们都知道作为接口有 信号传输能力和 电源传输能力两大指标，即使像 HDMI 或者 DP这种 纯信号传输接口实际上也会有电源引脚，这个电源有啥功能暂且按下不表。

作为接口至接口的传输媒介，线缆除了继承了 信号传输能力 和 电源传输能力 两大性能衡量标准以外，还有很重要的一点就是长度

在传统的应用方式中，一般都是在铜线上利用高速跳变的电信号来承载信息，但是缺点在于电信号频率越高，随传输距离的延长，信号衰减地越剧烈

比如 USB2.0 （480Mbps） 的 铜线线缆长度极限在5m

USB3.0 （5Gbps） 虽然规范没有定死，但是极限在3m

在 雷电3 （40Gbps）这里的时候，其实 铜线线缆极限被缩到了 1m，当然你可以举例苹果那个巨贵的 2m Thunderbolt Pro 线缆，但这也是仅此一家别无分号

线缆被局限在这么点距离自然是用户 不愿意看到的，既然铜线缆的物理极限是干不掉的，那么只好转变为光纤传输了

在线缆内部集成电信号转光信号模块，再由光纤进行传导，距离限制就不是问题了， HDMI与 DP 都有这种 转光信号传输的线缆，接口内置的电源主要派的这个用场

**这种新的 传输方式我们成为 主动式（有源线缆） 原先的的 铜缆系统 则称为被动式（无源线缆）**

因此线缆的性能指标在信号方面需要分化，根据传输方式需要分为两大类，朴素的来讲，性能衡量方式如下：

我们在下文谈论的线缆，默认是使用的最多的无源（被动式）

雷电协议有专属的 主动式（有源）线缆，但并不支持 同样是 Type-C 生态下的 USB3.0 或是 DP Alternative Mode

在雷电 主动式线缆中，USB传输功能仅被保留 USB 2.0 部分，电源则与常规的被动式相同，所以下面的 PD 线缆区分机制跟主动式线缆关系不怎么大了

### Power Delivery 线缆区分体系

Power Delivery 为 USB-C 系统确立了电源方面的标准，先前是最大 20V 5A，现在应该是最大48V 5A，但是线缆这个东西对电压是无所谓的，对电流比较敏感，毕竟  导线线阻不变的情况下，线损功率跟 电流的平方成正比

Power Delivery 大致将线缆分为了两档，第一档对电流最大支持到3A （过去USB 配备的 Battery Charge 支持最大也就是3A） 第二档是最大5A（实际有魔改空间，本文就不展开了）

为了区别基础款和高阶款 线缆，PD 规范要求高阶线缆内置 E-Mark 芯片，即电子标签；在主机插入线缆后由 PD控制器通过 Configuration Channel 读取线缆 的 E-Mark 信息，从而根据信息决定是否开放 3A以上的 充电能力

而常规 不搭载E-Mark 芯片的线缆，则默认只支持到3A 电流

在 数据传输的 体系方面，雷电也沿用了 电源方面的 Power Delivery 标准

先前谈到过的 DP Alternative Mode ，每Lane 速率也就 撑死 10Gbps，但在 Thunderbolt 之下宣称的40Gbps 速率，不知道你有没有考虑过实际上在线缆内是如何传输的？

实际上跟 USB3.x 一样，Thunderbolt 的数据仅通过 TX 与 RX链路进行全双工传输，Tx为数据发送，Rx为数据接收，40Gbps 实际上分为两组 Tx与Rx 进行传输，在物理上是两组 20Gbps 收发传输，在逻辑上则是 一组 40Gbps收发[[4]](https://zhuanlan.zhihu.com/p/390425571#ref_4)

为了区分 仅支持到每Lane 10Gbps 的基础款 和能支持到每 Lane 20Gbps 的高阶款传输线缆，同样采用了 E-Mark 芯片进行区分的做法

常规的 1m 内 无 E-Mark 芯片全定义线缆，同样可以支持运行 雷电 3协议，但会被限制在 10Gbps 每Lane 共 20Gbps速率；而有 E-Mark 的情况又有两类，即全速与半速，通常是某些具有 2m 长度又兼具 雷电3 运行要求的线缆会装备 半速 雷电 E-Mark

总之选购线缆的时候需要留意 数据传输 与 电源传输两个层面的 E-mark 支持

### 线缆缩水问题

当然还是那句老话， E-mark 仅仅是 E-mark 而已，并非线缆本身

装备了 E-Mark 芯片的线缆能够向PD控制器 报告自己的支持状况，开放更高性能支持，然而你说亩产万斤就能亩产万斤吗

实际上 目前市面上已经有 华强北出产的 40Gbps雷电线缆，但跟 HP 等厂子给的雷电线缆相比性能差异显著，便宜是便宜，购买的时候需要长点心

## 雷电设备典型拓补

与雷电主机方案的迭代不同，在 Alpine Ridge 时代，所有的 主控都是主机设备两用，但再往后 的7000系和 8000系时期就只有 x440 主控可用于设备了，因此实际上雷电设备的格局要简单一些，没有那么多阉割的弯弯绕

（ JHL7340以及 7540 尽管官方宣称只能用于主机口，实际上还是存疑）

### Alpine Ridge 典型设备拓补与公模案例

Alpine Ridge 系列虽然有三款主控 6540 6340 6240 都是主机设备两用，但是 6240 推出很晚且设备案例极少，所以可能只是一笔带过，这里主要涉及 6540 与 6340的 典型拓补和案例

需要注意的是，尽管在 主机上的雷电主控 支持那么多模式，USB，DP Alt Mode balabala，但成为设备以后，Alpine Ridge 外设只能支持 Thunderbolt Mode

此外，Alpine Ridge 这一代的设备设计，可以 明确 Intel 直接为设备商 提供了成品 雷电模块的原理与PCB设计，并且被外设厂商广泛使用，所以官方公模极具代表性

- DSL/JHL6540

由于是两用主控，6540的设备拓补基本和主机拓补没多大区别，官方给出的拓补参考简陋了点，所以我另外做了一个。基本就是在主机拓补的基础上 废除了两个 DP输入链路

原先的PCIe 上游口，在设备状态下成为了下游口，两个 Type-C 口都可以用于连接主机雷电口，建立连接后另外一个自动变为下游 雷电菊花链接口；GPIO 为电源以及 下游PCIe 接口提供休眠和中断控制信号

有一点细节奇怪的是，6540 雷电设备搭配的PD 控制器一般都是TPS659983 ，而不是跟 主机口同样的 TPS65982

Intel 官方公模参考：

这个公模被大量使用在了各类 雷电扩展坞，eGPU ，包括雷电采集卡产品上，举一些实例

雷电扩展坞方面：

- Targus Thunderbolt™ 3 DV4K Docking Station with Power Dock220

其他包括 Plugable TBT3-UDV，OWC Thunderbolt 3 Pro Dock ，Sonnet 数得上的外设牌子都有公模的案例

雷电3 eGPU方面：

其他还有不少就不一一举例了，很多淘宝寨牌 雷电扩展坞就是基于 这个模块 构建的eGPU

基本上只要看到 《 DC输入口，DP口，雷电口 *2 》 的接口排列基本就能确定是这个 6540 雷电公模

- DSL/JHL6340

6340 比6540的 案例和资料要少的多，虽然官方的手册指出了 6340 主控具有 DP输出能力，但目前没有将输出口做出来的案例， 6340 设备形态一般是 单 雷电3 口转PCIe Gen3 x4

官方提供了两类公模，一类是 PCIe 转接板的形式相比之前的 6540公模，电源设计极为寒酸，PD 充电功能就别指望了

国内寨牌基本也是Copy 的这个形式，目前的淘宝 雷电4 假扩展坞用的就是该模块

另一类公模就是雷电硬盘盒了，比如 HP 的P800[[22]](https://zhuanlan.zhihu.com/p/390425571#ref_22) 雷电硬盘盒，国内 品牌所有的 6340 雷电移动硬盘 都是用的该公模，顶多是调整一下电路板的 布局和 外型

- JHL6240

JHL6240 案例很少，在设备上的拓补基本跟 6340没啥区别，但是PCIe 被阉割到了 2 lane，虽然官方给出了具有 下游USB 以及 DP输出的 拓补，但同样没有产品案例

目前并没有显著的公模案例， 佳翼 曾经出过 JHL6240 的硬盘盒，但目前已经下架了

此外 威联通曾经出过 雷电3 转万兆网卡[[23]](https://zhuanlan.zhihu.com/p/390425571#ref_23)，用的就是 JHL6240 转 AQuantia AQC107S-B1的方案

### Titan Ridge 典型设备拓补与公模案例

Titan Ridge 的设备控制器有且仅有 JHL7440 一个，不过情况有点多变

**JHL7440 设备相比 原先的 Alpine Ridge新增了一个连接模式， 支持 USB以及 DP Alternative Mode连接**

**可以通过固件设定 增加 JHL7440 的 USB only，2 Lane或是 4Lane DP Alt Mode的支持，但该功能为optional，仅少数 JHL7440 配件支持**

此外我也弄到过一份 以 JHL7440 为基础的 配件Datasheet ，虽然说主要接口跟 官方的 7000系主控Brief[[24]](https://zhuanlan.zhihu.com/p/390425571#ref_24) 标的没什么区别，但是这个 DP Sink 口就显得很诡异

作为设备专用主控，理论上来说不应该是有这个 DP Sink 口，而且从没有哪家的产品将这个输入口做出来，推测可能 JHL7440 是在 原有的 主机控制器基础上改出来的，并且作为设备主控废弃了这个接口

在 PD控制器选用方面， 不像 Alpine Ridge 只搭配 TI 的TPS65983 主控，上文 提到过 在 Titan Ridge 主机口出现过搭配 TPS65983 或者 Cypress的 CYPD5225 两类案例，在JHL7440 设备口上也是一样的，不过 Cypress的 使用案例更为普遍，一般搭配的是 CYPD5235，搭配 TPS65983 的案例也有，但是很少，比如 Corsair TBT100 扩展坞[[25]](https://zhuanlan.zhihu.com/p/390425571#ref_25)

所以综合目前的资料，Titan Ridge 这一代的 独苗设备主控 JHL7440 应该是这样的拓补：

Titan Ridge 这一代不像之前的 Alpine Ridge 官方给公模，因此各个厂商 开发 7000系主控的雷电设备 迟缓的很。

不过还是有一家第三方厂子 Adaptertek[[26]](https://zhuanlan.zhihu.com/p/390425571#ref_26) 提供 JHL7440 的PCBA 模块，可惜的是仅支持 Thunderbolt Mode，不支持 DP Alt Mode 连接

模块做了两个型号，分别搭载一个或者两个 M.2 M key，直接命名为 Module 1 和 Module 2；要注意的是这模块上面的 M.2 M key 只是看起来是 M.2 而已，实际的引脚完全没 参照常规的 定义分布

Module 1 的下游口 给凹成了一个 M.2 M key，把 一路 DP1.4 和 USB3.2 Gen2 给塞了进去，此外还有 PD充电相关的电源和控制电路；这个模块一般给 扩展坞用

NODA Thunderbolt 3 Halo Dock[[28]](https://zhuanlan.zhihu.com/p/390425571#ref_28) ：

可能由于影响力有限或者功能局限性，所以其实没有正经牌子拿这个模块做坞站

另一个 Module 2 多了 1个 M.2 M key 下游接口，因此在 Module 1 的基础上还给了 4 Lane PCIe Gen3，把JHL7440 能给的下游接口都给全了，

所以玩法比之前的Module 1 多多了，比如 JIAYI 很早就搞的 能插 M.2 NVMe 盘的 雷电扩展坞，佳翼迭代了一次，旧型号好像已经停产了

还有eGPU形态，比如 Cooler Master MasterCase EG200 [[29]](https://zhuanlan.zhihu.com/p/390425571#ref_29)

除了 Adapterrek 以外还有一个不明厂商提供了一个 被广泛 使用的公模，是 能够支持USB连接 的 JHL7440 雷电3 硬盘盒方案，目前基本被 当作 USB4 硬盘盒被各个牌子进行再包装后售卖

通过 JHL7440 和 JMS583 的搭配，能够保证在 雷电连接和常规USB连接的情况下都能 转接出可用的 NVMe口，比 Alpine Ridge 时期的雷电移动硬盘 方案的 泛用性要好很多

但这个公模并不支持 USB2.0 接口使用，需要注意。

### Goshen Ridge （Tunderbolt 4 ）典型拓补与公模案例

在雷电4 这一带比较吊诡的是 主机控制器和设备控制器并不共用代号，而且相比先前的 设备控制器，这一带的独苗 JHL8440 做了极大幅度的改动

不过有个利好消息是 目前的 JHL8440 雷电4 方案都支持 DP Alt Mode连接

Thunderbolt 4实物产品推出已经有 一年多了，但 Thunderbolt 社区依然没有放出相关资料

PPT[[30]](https://zhuanlan.zhihu.com/p/390425571#ref_30)里面的JHL8340 也不知道在哪个娘胎里

根据目前的资料，推测拓补如下：

英特尔官方在 Goshen Ridge 这一带又亲自下场给设备制造商提供了公模方案[[31]](https://zhuanlan.zhihu.com/p/390425571#ref_31)，因此在 2021 这一年里 可以看到 N多 厂商都推出了同质化极为严重的 雷电 4 Dock

英特尔给的公模资料 目前看来就两种，一个是 给了 4 雷电口 + 1* 10Gbps USB口的 基础 拓补（但没给PCIe）

另一个则是在上述拓补的USB上再套更多的USB 扩展，作为一个全尺寸坞站方案，因此说到底除了雷电口以外的拓补 跟 USB扩展坞没什么两样

目前还暂时没有确认到可以把 PCIe 链路露出来的案例，总之先看吧；

这一代JHL8440 虽然下游雷电口多了两个，但是代价太大了，阉掉了原生的DP 输出以及把 4 Lane PCIe 给削到 只剩 1Lane，估计内置 NVMe 盘的坞站 还能指望一下，但雷电 4 移动硬盘和 eGPU是完全没戏了

### Thunderbolt 设备 通用进阶拓补

以上的 通用拓补实际上已经覆盖了目前的大部分雷电外设，不过么，作为目前最强力的消费级 传输协议，一些次世代设备自然是比较青睐 雷电协议，有些 特殊应用就 需要 利用雷电设备的 特殊模式了

- 下游雷电口 拓补变种

因为只有双口及以上的 雷电接口才能提供下游雷电口，所以这部分内容跟单口 的 6340 和 6240是无缘的了

先前们翻阅 雷电设备拓补的时候可以看到官方在双口主控的 Port B 部分都标注了这句话

Can also provide DP or USB 3.1 Gen2

这句话的含义是 下游雷电口可以被降格为 一路满血DP 或是 一条 10Gbps 的USB 3.2 Gen1

先谈降格 为DP 的部分，这个比较常见一些：雷电口降格而成的 DP与原有DP 共享 40Gbps的雷电总带宽，因此这种变形之后和原有DP组成的双DP的拓补 跟那种利用 DP MST 技术制造的 Type-C 转双DP 是有巨大区别的

英特尔也为这类拓补变种提供了公模设计，这种 雷电转 双 DP的配件不仅仅有 6540主控的双 DP1.2 输出版本，后续的 JHL7440 也有，提供两个 下游DP1.4

当然也会有 在DP上套一个 PS176或是 PS186 转成 HDMI的配件，比如 Belkin Thunderbolt 3 Dock Core[[32]](https://zhuanlan.zhihu.com/p/390425571#ref_32) 这俩 输出不是利用 DP MST 转出来的，而是都由 JHL7440 提供的

这种双 DP输出 典型的 视频输出特化拓补，直接用在高带宽需求的应用上比如 高分辨率显示器，肯定是比做成扩展坞要好的多不是吗？所以像 LG UltraFine 5K Display[[33]](https://zhuanlan.zhihu.com/p/390425571#ref_33) 就是应用该拓补的案例

而且这个显示器有前后两个版本 分别搭载了JHL6540 和 JHL7440主控，都是用的 双下游DP 拓补

到雷电4 这一代以后，由于 JHL8440 不再提供原生的 DP输出，所以这个降格 手段反而升值了，毕竟 HDMI 接口和 DP接口仍然具有硬需求，在比如 ThinkPad Universal Thunderbolt 4[[34]](https://zhuanlan.zhihu.com/p/390425571#ref_34) 上，就把一个 Thunderbolt 4接口 配置成 DP后，再接入[Synaptics VMM53328](https://link.zhihu.com/?target=https%3A//www.synaptics.com/products/video-interface-ics) 从而由这个 MST方案提供DP以及 HDMI接口

再讲 USB 降格手段，这个方式其实比较少见，在Titan Ridge 及之后的设备里都能原生提供一个下游 10Gbps USB，而在 6000系主控 时代一般利用 PCIe 挂一个 FL1100，这样就不缺USB了。所以也就只有对 PCIe 性能和USB 都有硬需求的 600系主控设备上才有可能看到这种降格手段，比如 Gigabyte AORUS Gaming Box[[35]](https://zhuanlan.zhihu.com/p/390425571#ref_35) ，牺牲了DSL6540 的下游雷电口来获得 USB'接口，同时保全 PCIe的性能

不过其实 ThinkPad Universal Thunderbolt 4[[34]](https://zhuanlan.zhihu.com/p/390425571#ref_34) 其实也使用了 降格USB，坞站使用了 两颗 VL822 10Gbps USB Hub 方案，并不是相对常见的 叠叠乐拓补，而是一个占据了 JHL8440的 原生 下游USB，另一个则占据了 降格后的 雷电4 接口

By the way， 有个很重要的要点， **被降格的 雷电口 不再需要 PD控制器的 支援**， 因此像 ThinkPad Universal Thunderbolt 4 这种双重降格 估计是想省一个 双口 PD 控制器 CYPD5235，真TM抠

还有一个很特别的 下游 雷电口拓补，比如像 Razer Core X Chroma[[36]](https://zhuanlan.zhihu.com/p/390425571#ref_36)

这个eGPU 有两条PCIe 扩展槽，一般我们会认为这是利用PLX 方案把雷电的PCIe 通道给分出来的或者是PCIe 外形的 USB接口罢了

但其实这玩意是 由主 拓补 JHL6540 利用下游 雷电3 接口 级联了 第二个雷电控制器 JHL6240，从而获得第二个PCIe 插槽

顺便，这个拓补没有将雷电 口降格，但被用来当作 第二级连接的 雷电链路也不需要 PD控制器支援

其实先前介绍的 6540 通用公模就应用了这种拓补

英特尔提供了主控板公模的同时也提供了下游 设备板的公模，设备板的接口都是由 PCIe转接出来的，但并不是使用的目前常见的叠叠乐结构，由PCIe 扩展USB 后 再把全部设备都挂在 USB下面

在6540 公模板中，USB主控 FL1100 和以太网主控 I210 是平行的，都是挂在PCIe之下

Well，是不是很困惑？ 我们使用计算机的时候 一般一个PCIe 插槽怼一个PCIe设备，即便可以怼多个，也需要PCIe 接口支持 拆分

但是众所周知 Intel 平台除了消费级旗舰，HEDT 以及服务器平台以外的 平台，PCIe 都难拆的很

这就是 雷电 设备又一个妙处了，通过固件配置，雷电主控 主控下游的 PCIe 链路可以 配置为 4 Lane 模式 为eGPU 或者雷电移动硬盘提供单设备高带宽连接，也能 配置为 2x 2 Lane 模式甚至 4x 1Lane 模式，下游 只要加个PCIe 时钟分频器 就能挂载高达 四个 PCIe 设备了，而成本则比 使用 PLX 不知道低到哪里去了（当然仅在挂载少量小带宽设备的时候）

比如说这种 显然用了 6540 公模的产品，使用了配置为 2x 2Lane 拆分的固件，再使用拆分卡转成两个 M.2 口，这两个口分别可以运行在 2Lane PCIe Gen 3 带宽下

而像 akasis 这种显然也用了 6540公模的，则换成了 4x 1Lane 固件，可以拆给 4个盘用

这些拆分方法不止可以用于挂载 NVMe盘，国内 针对 4 x 1Lane 的拆分方式应用最多的案例其实应该是 4路采集卡

不过么，由于今年 挖矿 需求的暴增，也有 通过 4x 1Lane 雷电拓补来 用雷电 配件外接 4块 GPU挖矿的 鬼畜邪道 玩法存在

上面几个都用的 6540主控，JHL7440 也有案例，比如佳翼 的新 雷电 3 扩展坞，可以将那个 JHL7440 Module 2的下游PCIe 拆分为 2x 2 Lane 模式，不过的话，目前暂未确认到JHL7440 支持 4x 1Lane 拆分

JHL6340 和 6240暂未确认到支持 PCIe 拆分的案例，总之存疑

至于 雷电 4 的JHL8440 么，反正下游就一根 1Lane 牙签 PCIe，想拆也拆不了了

USB 和DP 方面 其实不像 下游雷电和 PCIe 那样有那么多变数，一般也就顶多挂个Hub 或者 MST 扩展就到头了

唯一值得一提的就是加上 PD控制器的支援 ，将两者组合成支持 DP Alternative Mode 的 Type-C 接口

在雷电扩展坞方面目前只有 HP 的 Thunderbolt Dock G2[[37]](https://zhuanlan.zhihu.com/p/390425571#ref_37) 以及 Dell 的 WD19tb[[38]](https://zhuanlan.zhihu.com/p/390425571#ref_38) 会应用这种玩法（两者还是保留了 下游 雷电接口的传统结构）

## Conclusion

还是一句老话，我并不认为在日常应用中 Thunderbolt Mode 能比 DP1.4 Alternative Mode 多出什么显著优势

一般雷电设备需求都是基于雷电设备能够提供下游PCIe 这一结构特点，因此才成为 比如说 笔记本 10GbE 网络传输/ 外置 GPU / 外置磁盘阵列 用户 的共同选择，像我这种 纯玩票 用户其实反而是异类，这个帖子既不是安利 雷电配件 也不是 吹捧雷电的发展 前景，只是希望 用户多一份了解多一点理智

就知乎平台来说，一谈到 MacBook 扩展坞推荐一定要 推 Caldigt TS3+ 这种老掉牙的 6000系主控产品，浮躁的大环境如此，我觉得没什么比一篇可靠的总结更有用

单谈论 雷电 本身的话，我认为 Thunderbolt 4应该是最后一代 只支持到 PCIe Gen3 和 40Gbps速率的雷电，再加上 JHL8440 设备主控的摆烂，并不推荐目前入场，还是观望下一代 Thunderbolt 5 更合理一些，当然如果有需求的话——

- Dock 这种综合型 需求请挑选 JHL7440 和JHL8440 主控的合适产品，以三幻神（HP，Lenovo，Dell）的产品为最优选
- 大带宽 低延迟 PCIe （数据类扩展）外设需求的话，也就JHL7440主控可选了

具体产品则要根据具体需求选定

## Appendix

### JHL6240雷电主机口拓案例

由于 JHLx340 系列以及 JHL6240 主控 基本找不到资料，而且案例可能比 雷电 4 还难找，所以就不放在正文部分了

目前可以确认 ASUS GL502 和 GL702 机型采用的雷电控制器 是 JHL6240[[39]](https://zhuanlan.zhihu.com/p/390425571#ref_39)

ThinkPad 25 也是[[40]](https://zhuanlan.zhihu.com/p/390425571#ref_40)。

### JHLx340 雷电主机口拓案例&补参考

目前比较典型的案例：

HP FLEX IO Option Cards 3TK77AA （主控应当是JHL6340，存疑）

HP FLEX IO Option Cards 3TQ25AA 主控应当是JHL6340，存疑）

HP FLEX IO v2 Option Cards 1E8A4AA（主控为 JHL7340）

以上两者是HP 为了自家Z2 mini 之类的商务机/工作站开发的IO模块，还有板卡形态的

HP Thunderbolt 3 PCIe 1-Port I/O Card 4CX35AA （主控JHL7340）

华擎 X570 Phantom 也用的 JHL7340[[43]](https://zhuanlan.zhihu.com/p/390425571#ref_43)，这里搭配的PD控制器用的是 CYPD5225

### 雷电板卡安装相关

雷电扩展卡其实认真要讲的话我上手的并不多

我在 华擎的 Z170 Extreme 4 上驱动过 Dell 的29MVR （JHL6540）以及 GC-Titan Ridge（JHL7540）

微星 的Z390m Mortar 上驱动过 GC-Titan Ridge（JHL7540）

尝试过在 微星 X299 Creator 上驱动 GC-Titan Ridge（JHL7540）以及 GC-Maple Ridge（JHL8540）但都没成功，有 微星本身BIOS 的问题存在

每次驱动过程都很不愉快，伴随着长时间的折腾以及心态炸裂，所以我个人是不推荐 使用板卡的，个人建议要体验桌面雷电 方案的话，最好购买NUC，或者 Dell，HP，Lenovo 的现成配套 雷电模块，或者像上文提到过的 板载雷电控制器方案，诸如 Vision 系列或者 Unify，Pro Art 主板

实在要上的话，目前是建议用 GC-Titan Ridge，安装过程可以参考这篇笔记：

### Apple M1 系列集成IO控制器已知缺陷

M1 目前已经被苹果应用在自家的 MacBook 和 iPad 两大平台，针对两个不同的生态系统，苹果显然对M1的硬件特性作了不同的设定

USB only 模式下理论上是支持 到 USB3.2 Gen2 10Gbps，实际上速度上到 大约700Mbps左右就封顶了，比英特尔 Z系列芯片组 或者Asmedia 提供的外挂 USB 控制器要显著孱弱，推测是有两种可能: 控制器本身性能孱弱或者上游带宽没给够

不支持 DP MST （Mac OS 问题），同时指支持单显示器输出，无法通过 Thunderbolt Daisy Chain 扩展第二个外屏（但是有报告使用 JHL8440可以解决）

不支持绝大多数 PCIe 设备，仅能 支持部分 NVMe 盘 和部分 网卡，eGPU 全部阵亡

无法使用 Thunderbolt Mode 输出 5K （细节待考察）

无法使用 Thunderbolt Network Mode 连接其他 Thunderbolt 主机，只能作为 USB Slave 进行连接

### Intel Tiger Lake 系列集成雷电控制器已知缺陷

内容待定

## 参考